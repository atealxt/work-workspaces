<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>












  
    <title>DbUtils - JDBC Utility Component -- Examples</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="examples_files/print.css" 
type="text/css" media="print">
        <meta http-equiv="Content-Type" content="text/html; 
charset=ISO-8859-1">
      </head><body class="composite">
    <div id="banner">
                  <a href="http://commons.apache.org/" id="bannerLeft">
    
                                            <img 
src="examples_files/logo.png" alt="">
    
            </a>
                        <a 
href="http://commons.apache.org/dbutils/index.html" id="bannerRight">
    
                                            <img 
src="examples_files/logo_002.png" alt="">
    
            </a>
            <div class="clear">
        <hr>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
            
  
    
            <div class="xleft">
        Last Published: 08 November 2009
                  &nbsp;| Version: 1.3
                      </div>
            <div class="xright">            <a 
href="http://www.apachecon.com/" class="externalLink">ApacheCon</a>
            |
                <a href="http://www.apache.org/" class="externalLink">Apache</a>
            |
                <a href="http://commons.apache.org/">Commons</a>
            
  

  
    
            
  
    
  </div>
      <div class="clear">
        <hr>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
            
  
    
                   <h5>DbUtils</h5>
            <ul>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/dbutils/index.html">Overview</a>
          </li>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/downloads/download_dbutils.cgi">Download</a>
          </li>
              
    <li class="none">
              <strong>Examples</strong>
        </li>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/dbutils/changes-report.html">Release 
Notes</a>
          </li>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/dbutils/dependencies.html">Dependencies</a>
          </li>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/dbutils/license.html">License</a>
          </li>
              
    <li class="none">
                    <a href="http://wiki.apache.org/commons/DbUtils" 
class="externalLink">Wiki</a>
          </li>
          </ul>
              <h5>Development</h5>
            <ul>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/dbutils/mail-lists.html">Mailing Lists</a>
          </li>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/dbutils/issue-tracking.html">Issue 
Tracking</a>
          </li>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/dbutils/source-repository.html">Source 
Repository</a>
          </li>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/dbutils/building.html">Building</a>
          </li>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/dbutils/apidocs/index.html">Javadoc (SVN
 latest)</a>
          </li>
          </ul>
              <h5>Project Documentation</h5>
            <ul>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
                    <a 
href="http://commons.apache.org/dbutils/project-info.html">Project 
Information</a>
                </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
                    <a 
href="http://commons.apache.org/dbutils/project-reports.html">Project 
Reports</a>
                </li>
          </ul>
              <h5>Commons</h5>
            <ul>
              
    <li class="none">
                    <a href="http://commons.apache.org/">Home</a>
          </li>
              
                
              
      
              
        <li class="collapsed">
                    <a href="http://commons.apache.org/components.html">Components</a>
                </li>
              
                
              
      
              
        <li class="collapsed">
                    <a 
href="http://commons.apache.org/sandbox/index.html">Sandbox</a>
                </li>
              
                
              
      
              
        <li class="collapsed">
                    <a 
href="http://commons.apache.org/dormant/index.html">Dormant</a>
                </li>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/volunteering.html">Volunteering</a>
          </li>
              
    <li class="none">
                    <a href="http://commons.apache.org/patches.html">Contributing
 Patches</a>
          </li>
              
    <li class="none">
                    <a href="http://commons.apache.org/building.html">Building
 Components</a>
          </li>
              
    <li class="none">
                    <a 
href="http://commons.apache.org/releases/index.html">Releasing 
Components</a>
          </li>
              
    <li class="none">
                    <a href="http://wiki.apache.org/commons/FrontPage" 
class="externalLink">Wiki</a>
          </li>
          </ul>
              <h5>ASF</h5>
            <ul>
              
    <li class="none">
                    <a 
href="http://www.apache.org/foundation/sponsorship.html" 
class="externalLink">Sponsorship</a>
          </li>
              
    <li class="none">
                    <a 
href="http://www.apache.org/foundation/thanks.html" class="externalLink">Thanks</a>
          </li>
          </ul>
                                           <a 
href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
            <img alt="Built by Maven" 
src="examples_files/maven-feather.png">
          </a>
                       
  

  
    
            
  
    
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2><a 
name="DbUtils:_JDBC_Utility_Component_Examples"></a>DbUtils: JDBC 
Utility Component Examples</h2>
<p>
This page provides examples that show how DbUtils may be used.
</p>
</div>
<div class="section"><h2><a name="Basic_Usage"></a>Basic Usage</h2>
<p>
DbUtils is a very small library of classes so it won't take long 
to go through the <a href="http://commons.apache.org/dbutils/apidocs/">javadocs</a>
 for each class.  
The core classes/interfaces in DbUtils are 
<code><a 
href="http://commons.apache.org/dbutils/apidocs/org/apache/commons/dbutils/QueryRunner.html">QueryRunner</a></code>
and
<code><a 
href="http://commons.apache.org/dbutils/apidocs/org/apache/commons/dbutils/ResultSetHandler.html">ResultSetHandler</a></code>.
You don't need to know about any other DbUtils classes to benefit from 
using the 
library.  The following example demonstrates how these classes are used 
together.
</p>
<div class="source"><pre>
// Create a ResultSetHandler implementation to convert the
// first row into an Object[].
ResultSetHandler&lt;Object[]&gt; h = new ResultSetHandler&lt;Object[]&gt;() {
    public Object[] handle(ResultSet rs) throws SQLException {
        if (!rs.next()) {
            return null;
        }
    
        ResultSetMetaData meta = rs.getMetaData();
        int cols = meta.getColumnCount();
        Object[] result = new Object[cols];

        for (int i = 0; i &lt; cols; i++) {
            result[i] = rs.getObject(i + 1);
        }

        return result;
    }
};

// Create a QueryRunner that will use connections from
// the given DataSource
QueryRunner run = new QueryRunner(dataSource);

// Execute the query and get the results back from the handler
Object[] result = run.query(
    "SELECT * FROM Person WHERE name=?", h, "John Doe");

</pre>
</div>
<p>
You could also perform the previous query using a <code>java.sql.Connection</code>
 object
instead of a <code>DataSource</code>.  Notice that you are responsible 
for closing the
<code>Connection</code> in this example.
</p>
<div class="source"><pre>
ResultSetHandler&lt;Object[]&gt; h = ... // Define a handler the same as above example

// No DataSource so we must handle Connections manually
QueryRunner run = new QueryRunner();

Connection conn = ... // open a connection
try{
    Object[] result = run.query(
        conn, "SELECT * FROM Person WHERE name=?", h, "John Doe");
	// do something with the result
	
} finally {
    // Use this helper method so we don't have to check for null
    DbUtils.close(conn);  
}

</pre>
</div>
<p>
  You can not only fetch data from the database - you can also insert or
 update
  data. The following example will first insert a person into the 
database and
  after that change the person's height. 
</p>
<div class="source"><pre>
QueryRunner run = new QueryRunner( dataSource );
try
{
    // Execute the SQL update statement and return the number of
    // inserts that were made
    int inserts = run.update( "INSERT INTO Person (name,height) VALUES (?,?)",
                              "John Doe", 1.82 );
    // The line before uses varargs and autoboxing to simplify the code

    // Now it's time to rise to the occation...
    int updates = run.update( "UPDATE Person SET height=? WHERE name=?",
                              2.05, "John Doe" );
    // So does the line above
}
catch(SQLException sqle) {
    // Handle it
}

</pre>
</div>
</div>
<div class="section"><h2><a name="ResultSetHandler_Implementations"></a>ResultSetHandler
 Implementations</h2>
<p>
In the examples above we implemented the <code>ResultSetHandler</code> 
interface
to turn the first row of the <code>ResultSet</code> into an Object[].  
This is a
fairly generic implementation that can be reused across many projects.
In recognition of this DbUtils provides a set of <code>ResultSetHandler</code>
implementations in the 
<a 
href="http://commons.apache.org/dbutils/apidocs/org/apache/commons/dbutils/handlers/package-summary.html">org.apache.commons.dbutils.handlers</a>
 
package that perform common transformations into arrays, Maps, and 
JavaBeans.
There is a version of each implementation that converts just the first 
row and 
another that converts all rows in the <code>ResultSet</code>. 
</p>
<p>
  We'll start with an example using the <code>BeanHandler</code> to 
fetch one
  row from the <code>ResultSet</code> and turn it into a JavaBean. 
</p>
<div class="source"><pre>
QueryRunner run = new QueryRunner(dataSource);

// Use the BeanHandler implementation to convert the first
// ResultSet row into a Person JavaBean.
ResultSetHandler&lt;Person&gt; h = new BeanHandler(Person.class);

// Execute the SQL statement with one replacement parameter and
// return the results in a new Person object generated by the BeanHandler.
Person p = run.query(
    "SELECT * FROM Person WHERE name=?", h, "John Doe"); 

</pre>
</div>
<p>
  This time we will use the BeanListHandler to fetch all rows from the
  <code>ResultSet</code> and turn them into a <code>List</code> of 
JavaBeans. 
</p>
<div class="source"><pre>
QueryRunner run = new QueryRunner(dataSource);

// Use the BeanListHandler implementation to convert all
// ResultSet rows into a List of Person JavaBeans.
ResultSetHandler&lt;List&lt;Person&gt;&gt; h = new BeanListHandler(Person.class);

// Execute the SQL statement and return the results in a List of
// Person objects generated by the BeanListHandler.
List&lt;Person&gt; persons = run.query("SELECT * FROM Person", h);

</pre>
</div>
</div>
<div class="section"><h2><a name="Custom_RowProcessor"></a>Custom 
RowProcessor</h2>
<p>
Each of the provided <code>ResultSetHandler</code> implementations 
accept a 
<a 
href="http://commons.apache.org/dbutils/apidocs/org/apache/commons/dbutils/RowProcessor.html">RowProcessor</a>
to do the actual conversion of rows into objects.  By default the 
handlers
use the <a 
href="http://commons.apache.org/dbutils/apidocs/org/apache/commons/dbutils/BasicRowProcessor.html">BasicRowProcessor</a>
 
implementation but you can implement a custom version to plug in.
Probably the most common customization is to implement the <code>toBean()</code>
method to handle custom database datatype issues.
</p>
</div>
<div class="section"><h2><a name="Custom_BeanProcessor"></a>Custom 
BeanProcessor</h2>
<p><code>BasicRowProcessor</code> uses a <a 
href="http://commons.apache.org/dbutils/apidocs/org/apache/commons/dbutils/BeanProcessor.html">BeanProcessor</a>
to convert <code>ResultSet</code> columns into JavaBean properties.  You
 can 
subclass and override processing steps to handle datatype mapping 
specific to 
your application.  The provided implementation delegates datatype 
conversion to 
the JDBC driver.
</p>
<p>
BeanProcessor maps columns to bean properties as documented in the 
<a 
href="http://commons.apache.org/dbutils/apidocs/org/apache/commons/dbutils/BeanProcessor.html#toBean%28java.sql.ResultSet,%20java.lang.Class%29">BeanProcessor.toBean()</a>
 javadoc.  
Column names must match the bean's property names case insensitively.  
For example, the <code>firstname</code> column would be stored in the 
bean 
by calling its <code>setFirstName()</code> method.  However, many 
database 
column names include characters that either can't be used or are not 
typically 
used in Java method names.  You can do one of the following to map 
these columns to bean properties:
</p><ol type="1"><li>
        Alias the column names in the SQL so they match the Java names: 
 
        <code>select social_sec# as socialSecurityNumber from person</code></li>
<li>
        Subclass BeanProcessor and override the <a 
href="http://commons.apache.org/dbutils/apidocs/org/apache/commons/dbutils/BeanProcessor.html#mapColumnsToProperties%28java.sql.ResultSetMetaData,%20java.beans.PropertyDescriptor[]%29">mapColumnsToProperties()</a>
 
        method to strip out the offending characters.
    </li>
</ol>

</div>

      </div>
    </div>
    <div class="clear">
      <hr>
    </div>
    <div id="footer">
      <div class="xright">©  
          2002-2009
    
          The Apache Software Foundation
          
  

  
    
            
  
    
  </div>
      <div class="clear">
        <hr>
      </div>
    </div>
  </body></html>
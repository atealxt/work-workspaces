<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
  <!-- 数据源的配置 //-->
  <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
    <property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/>
    <property name="url" value="jdbc:oracle:thin:@localhost:1521:ora9i"/>
    <property name="username" value="test"/>
    <property name="password" value="test"/>
  </bean>
  <!-- 以下是： 处理Blob类型的特殊声明 //-->
  <bean id="nativeJdbcExtractor" class="org.springframework.jdbc.support.nativejdbc.CommonsDbcpNativeJdbcExtractor" lazy-init="true"/>
  <bean id="lobHandler" class="org.springframework.jdbc.support.lob.OracleLobHandler" lazy-init="true">
    <property name="nativeJdbcExtractor">
      <ref local="nativeJdbcExtractor"/>
    </property>
  </bean>

  <bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
    <property name="dataSource" ref="dataSource"/>
    <!-- 为处理Blob类型字段的句柄声明 //-->
    <property name="lobHandler" ref="lobHandler"/>
    <property name="hibernateProperties">
      <props>
        <prop key="hibernate.dialect">org.hibernate.dialect.OracleDialect</prop>
        <prop key="hibernate.show_sql">true</prop>
        <prop key="hibernate.cglib.use_reflection_optimizer">true</prop>
      </props>
    </property>
    <property name="mappingDirectoryLocations">
      <list>
        <value>classpath:/sshfile/model</value>
      </list>
    </property>
  </bean>

  <!-- DAO 的IoC配置//-->
  <bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
    <property name="sessionFactory" ref="sessionFactory"/>
  </bean>
  <bean id="tfileDAO" class="sshfile.dao.TfileDAOHibernate">
    <property name="hibernateTemplate" ref="hibernateTemplate" />
  </bean>



  <bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
    <property name="sessionFactory" ref="sessionFactory"/>
  </bean>
  <!-- 事务处理的AOP配置 //-->
  <bean id="txProxyTemplate" abstract="true" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
    <property name="transactionManager" ref="transactionManager"/>
    <property name="transactionAttributes">
      <props>
         <prop key="get*">PROPAGATION_REQUIRED,readOnly</prop>
         <prop key="find*">PROPAGATION_REQUIRED,readOnly</prop>
         <prop key="save">PROPAGATION_REQUIRED</prop>
         <prop key="write">PROPAGATION_REQUIRED,readOnly</prop>
      </props>
    </property>
  </bean>
  <bean id="fileService" parent="txProxyTemplate">
    <property name="target">
      <bean class="sshfile.service.FileServiceImpl">
        <property name="tfileDAO" ref="tfileDAO"/>
      </bean>
    </property>
  </bean>
</beans>

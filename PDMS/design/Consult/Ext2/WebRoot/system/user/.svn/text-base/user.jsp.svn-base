<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"
	contentType="text/html; charset=UTF-8"%>
<%
	String path = request.getContextPath();
	String basePath = request.getScheme() + "://"
			+ request.getServerName() + ":" + request.getServerPort()
			+ path + "/";
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<base href="<%=basePath%>">

		<title>角色资源权限管理</title>
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="expires" content="0">
		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
		<style type="text/css">

    </style>
		<script>
		
		//转换系统用户状态
		Test.render3 = function(value, p, r){
				if(value=="1"){
		        	return "正常";
		        }else 
		        if(value=="2"){
		        	return "注销";
		        }else 
		        if(value=="32"){
		        	return "冻结";
		        }
		    };
		    
		//转换系统用户是否有效
		Test.render4 = function(value, p, r){
				if(value=="1"){
		        	return "有效";
		        }else{
		        	return "无效";
		        }
		    };    
		
		Ext.onReady(function(){
	       	
	       	var store_fields = [
	        	       {name: 'userid'},
		               {name: 'loginname'},
		                {name: 'passwd'},
		               {name: 'areaname'},
		               {name: 'area'},
		               {name: 'remark'},
		               {name: 'statusid'},
		               {name: 'enabled'},
		               {name: 'roleid'},
		               {name: 'rolename'},
		               {name: 'roleuserid'}	
	        ];//接收后台数据的对象
	        
	        // simple array store
		    var sourcetype_store = new Ext.data.SimpleStore({
		        fields: ['codeValue', 'codeText'],
		        data : [['1', '正常'],['2', '注销'],['3', '冻结']]
		    }); 
	        
	        var sm = new Ext.grid.CheckboxSelectionModel();//列的多选框
	        //var sm = new Ext.grid.RowSelectionModel({singleSelect:true});//只选中某行      
	        
	        var cm = new Ext.grid.ColumnModel([
				new Ext.grid.RowNumberer(),//自动行号
				sm,
				{
		            id: 'userid', 
		            header: "用户ID",
		            dataIndex: 'userid',
		            width: 50,
		            hidden: false
		            //align: 'right',
		            //renderer: Renderers.renderTopic,	            	            
		        },{
		            header: "用户名",
		            dataIndex: 'loginname',
		            width: 100
		        },{
		            header: "用户密码",
		            dataIndex: 'passwd',
		            width: 100,		          
		            hidden: true		            
		        },{
		            header: "区域ID",
		            dataIndex: 'area',
		            width: 100,
		            hidden: true		            
		        },{
		            header: "所在区域",
		            dataIndex: 'areaname',
		            width: 100,
		            hidden: false		            
		        },{
		            header: "角色ID",
		            dataIndex: 'roleid',
		            width: 100,
		            hideable : false,
		            hidden: true		            
		        },{
		            header: "角色名称",
		            dataIndex: 'rolename',
		            width: 100,
		            hidden: false		            
		        },{
		            header: "备注",
		            dataIndex: 'remark',
		            width: 100,
		            hidden: true		            
		        },{
		            header: "状态",
		            dataIndex: 'statusid',
		            renderer: Test.render3,		            
		            width: 100		            
		        },{
		            header: "是否有效",
		            dataIndex: 'enabled',
		            renderer: Test.render4,	
		            width: 100		            
		        },{
		            header: "角色用户ID",
		            dataIndex: 'roleuserid',
		            hideable : false,
		            hidden: true,	
		            width: 100		            
		        }]);
		        
		     var area_store = new Ext.data.Store({	        
		        proxy: new Ext.data.HttpProxy({
		            url: '<%=path%>/system/area!comboList.action'
		        }),
		        reader: new Ext.data.JsonReader({
		            fields: ['codeValue', 'codeText']
		        }) 
		    });//获取区域信息
		    
		    area_store.load();   // 加载数据	
		    
		    var role_store = new Ext.data.Store({	        
		        proxy: new Ext.data.HttpProxy({
		            url: '<%=path%>/system/role!comboList.action'
		        }),
		        reader: new Ext.data.JsonReader({
		            fields: ['codeValue', 'codeText']
		        }) 
		    });//获取角色信息
		    role_store.load();   // 加载数据		        		    
		    
	        var form_items = [{
	        		inputType:'hidden',
	                name: 'userid'
	           	},{
	        		inputType:'hidden',
	                name: 'roleuserid'
	           	},{
	                fieldLabel: '用户名称',
	                name: 'loginname',
	                allowBlank:false,
	                readOnly: false
	                
	           	},{
	                fieldLabel: '用户密码',
	                inputType:'password',
	                allowBlank:false,
	                name: 'passwd',
	                readOnly: false
	           	},{
	           		xtype:"combo",
	           		store: sourcetype_store,
		            fieldLabel: "用户状态",
		            name: 'statusid',            
    				valueField :"codeValue",
                    displayField: "codeText",
                    mode: 'local',//'remote'
                    forceSelection: true,
                    allowBlank:false,
                    blankText:'请选择用户状态',
                    emptyText:'请选择用户状态',
                    hiddenName:"statusid",
                    editable: true,
                    triggerAction: 'all'
	        	},{
	           		xtype:"combo",
	           		store:area_store,	           		
		            fieldLabel: "所在区域",
		            name: 'area',
		            valueField :"codeValue",
                    displayField: "codeText",                				
                    mode: 'local',//'remote'
                    forceSelection: true,
                    allowBlank:false,
                    blankText:'请选择用户所在区域',
                    emptyText:'请选择用户所在区域',
                    hiddenName:"area",
                    editable: true,
                    triggerAction: 'all'
	        	},{
	           		xtype:"combo",
	           		store:role_store,	           		
		            fieldLabel: "用户角色",
		            name: 'roleid',
		            valueField :"codeValue",
                    displayField: "codeText",                				
                    mode: 'local',//'remote'
                    forceSelection: true,
                    allowBlank:false,
                    blankText:'请选择用户角色',
                    emptyText:'请选择用户角色',
                    hiddenName:"roleid",
                    editable: false,
                    triggerAction: 'all'
	        	},{
	                fieldLabel: '备注',
	                name: 'remark',
	                readOnly: false
	                
	           	}];
		    
		    var otherBar = ['-','用户名: ',{
				    	xtype:'textfield',
				    	width:200,
				    	id:'loginname',
				    	name:'loginname'
			    	},'-',{
				    	text:'搜索',
				    	iconCls:'icon-srch',
				    	handler:function(){
					       userlist.store.lastOptions.params['start'] = 0;
					       userlist.store.reload();
				        }
			    	}    	
			    ]
		    
		        
			var config = {
				//----------查询条件Form配置-----------------------
				needConform:false,//是否需要查询条件
				//conform_height:110,//查询面板高度
				//conform_items:conform_items,//查询条件Form属性
				//----------主键ID--------------------------------
				idProperty:'userid',
				//----------表格数据配置----------------------------
				store_fields:store_fields,
				store_url:'<%=path%>/system/sysuser!list.action',
				limit:10,
				//-----------表格组件配置---------------------------
				gridTitle:'用户列表',
				sm:sm,
				cm:cm,
				autoExpandColumn:'loginname',
				needCurdBar:true,
				otherBar:otherBar,
				search:[{name:'loginname',mapping:'loginname'}],
				//-----------对话框配置-----------------------------
				dlgTitle:'用户信息',
				dlgWidth:400,
				dlgHeight:300,
				//-----------详细Form配置---------------------------
				form_items:form_items,	
				create_url:'<%=path%>/system/sysuser!create.action',
				update_url:'<%=path%>/system/sysuser!update.action',
				delete_url:'<%=path%>/system/sysuser!delete.action',
				delete_otherParams:['roleuserid'],
				//-----------显示配置-------------------------------
				tabId:'<%=request.getParameter("tabId")%>'
			};
			
			var userlist = new Test.CURD(config);					    
			userlist.init();
			
		}); 
		
		
		   
	</script>
	</head>

	<body>

	</body>
</html>
